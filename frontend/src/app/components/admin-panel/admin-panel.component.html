<div class="admin-panel">
  <div class="admin-header">
    <h1>ğŸ‘‘ Admin-Panel</h1>
  </div>

  <!-- Tabs -->
  <div class="tabs">
    <button
      class="tab"
      [class.active]="activeTab() === 'welcome'"
      (click)="setActiveTab('welcome')">
      ğŸ“¢ Willkommensnachricht
    </button>
    <button
      class="tab"
      [class.active]="activeTab() === 'broadcast'"
      (click)="setActiveTab('broadcast')">
      ğŸ“£ Broadcast-Posts
    </button>
    <button
      class="tab"
      [class.active]="activeTab() === 'status'"
      (click)="setActiveTab('status')">
      ğŸ“Š System-Status
    </button>
    <button
      class="tab"
      [class.active]="activeTab() === 'settings'"
      (click)="setActiveTab('settings')">
      âš™ï¸ Seiteneinstellungen
    </button>
    <button
      class="tab"
      [class.active]="activeTab() === 'email-templates'"
      (click)="setActiveTab('email-templates')">
      ğŸ“§ E-Mail-Templates
    </button>
  </div>

  <!-- Messages -->
  @if (error()) {
    <div class="alert alert-error">{{ error() }}</div>
  }

  @if (success()) {
    <div class="alert alert-success">{{ success() }}</div>
  }

  <!-- Welcome Message Tab -->
  @if (activeTab() === 'welcome') {
    <div class="tab-content">
      <h2>Willkommensnachricht verwalten</h2>
      <p class="description">
        Die Willkommensnachricht wird jedem Benutzer beim ersten Login angezeigt.
      </p>

      @if (welcomeStats()) {
        <div class="stats-card">
          <h3>ğŸ“Š Statistiken</h3>
          <div class="stats-grid">
            <div class="stat">
              <span class="stat-label">Gesamt-Benutzer:</span>
              <span class="stat-value">{{ welcomeStats()!.total_users }}</span>
            </div>
            <div class="stat">
              <span class="stat-label">Gesehen:</span>
              <span class="stat-value">{{ welcomeStats()!.seen_count }}</span>
            </div>
            <div class="stat">
              <span class="stat-label">Noch nicht gesehen:</span>
              <span class="stat-value">{{ welcomeStats()!.unseen_count }}</span>
            </div>
          </div>
        </div>
      }

      <div class="form-card">
        <div class="form-group">
          <label for="welcome-title">Titel</label>
          <input
            id="welcome-title"
            type="text"
            [(ngModel)]="welcomeForm.title"
            placeholder="z.B. Willkommen bei SafeSpace!"
            maxlength="100">
        </div>

        <div class="form-group">
          <label for="welcome-content">Nachricht</label>
          <textarea
            id="welcome-content"
            [(ngModel)]="welcomeForm.content"
            placeholder="Deine Willkommensnachricht..."
            rows="8"></textarea>
        </div>

        <div class="button-group">
          <button
            class="btn btn-primary"
            (click)="saveWelcomeMessage()"
            [disabled]="loading()">
            {{ loading() ? 'â³ Speichern...' : 'ğŸ’¾ Speichern' }}
          </button>

          @if (welcomeMessage()) {
            <button
              class="btn btn-danger"
              (click)="deleteWelcomeMessage()"
              [disabled]="loading()">
              ğŸ—‘ï¸ LÃ¶schen
            </button>
          }
        </div>
      </div>
    </div>
  }

  <!-- Broadcast Posts Tab -->
  @if (activeTab() === 'broadcast') {
    <div class="tab-content">
      <h2>Broadcast-Post erstellen</h2>
      <p class="description">
        Broadcast-Posts werden automatisch an alle Benutzer in ihrem Feed angezeigt und
        in deren Sprache Ã¼bersetzt.
      </p>

      <div class="form-card">
        <div class="form-group">
          <label for="broadcast-content">Post-Inhalt</label>
          <textarea
            id="broadcast-content"
            [(ngModel)]="broadcastForm.content"
            placeholder="Deine Nachricht an alle Benutzer..."
            rows="5"></textarea>
        </div>

        <div class="form-group">
          <label for="broadcast-visibility">Sichtbarkeit</label>
          <select id="broadcast-visibility" [(ngModel)]="broadcastForm.visibility">
            <option value="public">Ã–ffentlich</option>
            <option value="friends">Nur Freunde</option>
          </select>
        </div>

        <button
          class="btn btn-primary"
          (click)="createBroadcastPost()"
          [disabled]="loading()">
          {{ loading() ? 'â³ Erstellen...' : 'ğŸ“£ Broadcast senden' }}
        </button>
      </div>

      <h3>Bestehende Broadcast-Posts</h3>
      <div class="posts-list">
        @if (broadcastPosts().length === 0) {
          <p class="empty-state">Keine Broadcast-Posts vorhanden</p>
        }

        @for (post of broadcastPosts(); track post.post_id) {
          <div class="broadcast-post-card">
            <div class="post-header">
              <span class="post-date">{{ post.created_at | date:'medium' }}</span>
              <button
                class="btn-delete"
                (click)="deleteBroadcastPost(post.post_id)">
                ğŸ—‘ï¸
              </button>
            </div>
            <p class="post-content">{{ post.content }}</p>
            <div class="post-stats">
              <span>â¤ï¸ {{ post.likes_count }}</span>
              <span>ğŸ’¬ {{ post.comments_count }}</span>
            </div>
          </div>
        }
      </div>
    </div>
  }

  <!-- System Status Tab -->
  @if (activeTab() === 'status') {
    <div class="tab-content">
      <div class="status-header">
        <h2>ğŸ“Š System-Status</h2>
        <button class="btn-refresh" (click)="loadSystemStatus()">ğŸ”„ Aktualisieren</button>
      </div>

      @if (systemStatus()) {
        <div class="status-container">
          <!-- Server Uptime -->
          <div class="status-section">
            <h3>â±ï¸ Server</h3>
            <div class="stats-grid">
              <div class="stat">
                <span class="stat-label">Uptime:</span>
                <span class="stat-value">{{ systemStatus()!.system.uptime }}</span>
              </div>
              <div class="stat">
                <span class="stat-label">Letzte Aktualisierung:</span>
                <span class="stat-value">{{ systemStatus()!.timestamp | date:'medium' }}</span>
              </div>
            </div>
          </div>

          <!-- System Performance -->
          <div class="status-section">
            <h3>ğŸ’» Performance</h3>
            <div class="stats-grid">
              <div class="stat">
                <span class="stat-label">CPU Auslastung:</span>
                <span class="stat-value" [class.warning]="systemStatus()!.system.cpu_percent > 80">
                  {{ systemStatus()!.system.cpu_percent }}%
                </span>
              </div>
              <div class="stat">
                <span class="stat-label">RAM Auslastung:</span>
                <span class="stat-value" [class.warning]="systemStatus()!.system.memory.percent > 85">
                  {{ systemStatus()!.system.memory.percent }}%
                </span>
              </div>
              <div class="stat">
                <span class="stat-label">RAM Genutzt:</span>
                <span class="stat-value">
                  {{ systemStatus()!.system.memory.used_gb }} GB / {{ systemStatus()!.system.memory.total_gb }} GB
                </span>
              </div>
              <div class="stat">
                <span class="stat-label">Disk Auslastung:</span>
                <span class="stat-value" [class.warning]="systemStatus()!.system.disk.percent > 85">
                  {{ systemStatus()!.system.disk.percent }}%
                </span>
              </div>
              <div class="stat">
                <span class="stat-label">Disk Genutzt:</span>
                <span class="stat-value">
                  {{ systemStatus()!.system.disk.used_gb }} GB / {{ systemStatus()!.system.disk.total_gb }} GB
                </span>
              </div>
              <div class="stat">
                <span class="stat-label">Disk Frei:</span>
                <span class="stat-value">
                  {{ systemStatus()!.system.disk.free_gb }} GB
                </span>
              </div>
            </div>
          </div>

          <!-- User Statistics -->
          <div class="status-section">
            <h3>ğŸ‘¥ Benutzer</h3>
            <div class="stats-grid">
              <div class="stat">
                <span class="stat-label">Registrierte Benutzer:</span>
                <span class="stat-value highlight">{{ systemStatus()!.users.total }}</span>
              </div>
              <div class="stat">
                <span class="stat-label">Online (letzte 5 Min):</span>
                <span class="stat-value online">{{ systemStatus()!.users.online_5min }}</span>
              </div>
              <div class="stat">
                <span class="stat-label">Aktiv (letzte 15 Min):</span>
                <span class="stat-value">{{ systemStatus()!.users.active_15min }}</span>
              </div>
              <div class="stat">
                <span class="stat-label">Neue Benutzer heute:</span>
                <span class="stat-value">{{ systemStatus()!.users.new_today }}</span>
              </div>
              <div class="stat">
                <span class="stat-label">Neue Benutzer (7 Tage):</span>
                <span class="stat-value">{{ systemStatus()!.users.new_week }}</span>
              </div>
            </div>

            @if (systemStatus()!.users.roles) {
              <div class="roles-grid">
                <h4>Rollen</h4>
                <div class="stats-grid">
                  @for (role of objectKeys(systemStatus()!.users.roles); track role) {
                    <div class="stat">
                      <span class="stat-label">{{ getRoleLabel(role) }}:</span>
                      <span class="stat-value">{{ systemStatus()!.users.roles[role] }}</span>
                    </div>
                  }
                </div>
              </div>
            }
          </div>

          <!-- Social Statistics -->
          <div class="status-section">
            <h3>ğŸ¤ Soziale AktivitÃ¤t</h3>
            <div class="stats-grid">
              <div class="stat">
                <span class="stat-label">Freundschaften:</span>
                <span class="stat-value">{{ systemStatus()!.social.friendships }}</span>
              </div>
              <div class="stat">
                <span class="stat-label">Offene Freundschaftsanfragen:</span>
                <span class="stat-value">{{ systemStatus()!.social.pending_friend_requests }}</span>
              </div>
              <div class="stat">
                <span class="stat-label">Posts (geschÃ¤tzt):</span>
                <span class="stat-value">{{ systemStatus()!.social.posts_estimate }}</span>
              </div>
            </div>
          </div>

          <!-- Moderation Statistics -->
          <div class="status-section">
            <h3>ğŸ›¡ï¸ Moderation</h3>
            <div class="stats-grid">
              <div class="stat">
                <span class="stat-label">Offene Reports:</span>
                <span class="stat-value" [class.warning]="systemStatus()!.moderation.open_reports > 10">
                  {{ systemStatus()!.moderation.open_reports }}
                </span>
              </div>
              <div class="stat">
                <span class="stat-label">Gesamt Reports:</span>
                <span class="stat-value">{{ systemStatus()!.moderation.total_reports }}</span>
              </div>
            </div>
          </div>
        </div>
      } @else {
        <div class="loading-state">
          <p>â³ Lade System-Status...</p>
        </div>
      }
    </div>
  }

  <!-- Site Settings Tab -->
  @if (activeTab() === 'settings') {
    <div class="tab-content">
      <h2>âš™ï¸ Seiteneinstellungen</h2>
      <p class="description">
        Hier kannst du den Titel der Seite Ã¤ndern. Der Titel wird in der Navbar und im Browser-Tab angezeigt.
      </p>

      <div class="form-card">
        <div class="form-group">
          <label for="site-title">Seitentitel</label>
          <input
            id="site-title"
            type="text"
            [(ngModel)]="siteTitleForm"
            placeholder="z.B. SocialNet"
            maxlength="50">
          <p class="field-hint">Dieser Titel wird oben links in der Navigation und als Browser-Tab-Titel angezeigt.</p>
        </div>

        <div class="button-group">
          <button
            class="btn btn-primary"
            (click)="saveSiteTitle()"
            [disabled]="loading()">
            {{ loading() ? 'â³ Speichern...' : 'ğŸ’¾ Titel speichern' }}
          </button>
        </div>
      </div>
    </div>
  }

  <!-- Email Templates Tab -->
  @if (activeTab() === 'email-templates') {
    <div class="tab-content">
      <h2>ğŸ“§ E-Mail-Templates</h2>
      <p class="description">
        Hier kannst du die E-Mail-Benachrichtigungen bearbeiten. Verwende Platzhalter
        und Ã¼bersetze Templates per Knopfdruck in alle Sprachen.
      </p>

      <div class="form-card">
        <!-- Typ und Sprache Auswahl -->
        <div class="template-selectors">
          <div class="form-group">
            <label for="template-type">Benachrichtigungstyp</label>
            <select id="template-type" [(ngModel)]="selectedNotificationType" (change)="onTemplateTypeChange()">
              @for (type of notificationTypes(); track type) {
                <option [value]="type">{{ notificationTypeLabels[type] || type }}</option>
              }
            </select>
          </div>

          <div class="form-group">
            <label for="template-lang">Sprache</label>
            <select id="template-lang" [(ngModel)]="selectedTemplateLang" (change)="onTemplateLangChange()">
              @for (lang of availableLanguages; track lang.code) {
                <option [value]="lang.code">{{ lang.flag }} {{ lang.name }}</option>
              }
            </select>
          </div>
        </div>

        <!-- Betreff -->
        <div class="form-group">
          <label for="template-subject">Betreff</label>
          <input
            id="template-subject"
            type="text"
            [(ngModel)]="templateSubject"
            [placeholder]="subjectPlaceholderText">
        </div>

        <!-- WYSIWYG Toolbar -->
        <div class="form-group">
          <label>Inhalt</label>
          <div class="editor-toolbar">
            <button type="button" class="toolbar-btn" (click)="execCommand('bold')" title="Fett"><b>B</b></button>
            <button type="button" class="toolbar-btn" (click)="execCommand('italic')" title="Kursiv"><i>I</i></button>
            <button type="button" class="toolbar-btn" (click)="execCommand('underline')" title="Unterstrichen"><u>U</u></button>
            <span class="toolbar-separator"></span>
            <button type="button" class="toolbar-btn" (click)="execCommand('insertUnorderedList')" title="Liste">&#8226;</button>
            <button type="button" class="toolbar-btn" (click)="execCommand('justifyLeft')" title="Links">&#8676;</button>
            <button type="button" class="toolbar-btn" (click)="execCommand('justifyCenter')" title="Zentriert">&#8596;</button>
            <span class="toolbar-separator"></span>
            <button type="button" class="toolbar-btn" (click)="execCommand('removeFormat')" title="Formatierung entfernen">&#10005;</button>
          </div>

          <!-- Editor -->
          <div
            id="template-editor"
            class="wysiwyg-editor"
            contenteditable="true"
            (input)="onEditorInput($event)"
            [innerHTML]="templateBody">
          </div>
        </div>

        <!-- Platzhalter Buttons -->
        <div class="placeholder-section">
          <label>Platzhalter einfÃ¼gen:</label>
          <div class="placeholder-buttons">
            @for (ph of placeholders; track ph) {
              <button type="button" class="placeholder-btn" (click)="insertPlaceholder(getPlaceholderTag(ph))">{{ getPlaceholderTag(ph) }}</button>
            }
          </div>
        </div>

        <!-- Action Buttons -->
        <div class="button-group" style="margin-top: 20px;">
          <button
            class="btn btn-primary"
            (click)="saveEmailTemplate()"
            [disabled]="loading()">
            {{ loading() ? 'â³ Speichern...' : 'ğŸ’¾ Template speichern' }}
          </button>
          <button
            class="btn btn-translate"
            (click)="translateTemplate()"
            [disabled]="translating()">
            {{ translating() ? 'â³ Ãœbersetze...' : 'ğŸŒ In alle Sprachen Ã¼bersetzen' }}
          </button>
        </div>
      </div>

      <!-- Template Ãœbersicht -->
      <div class="form-card" style="margin-top: 20px;">
        <h3>Vorhandene Templates</h3>
        <div class="template-overview">
          @for (type of notificationTypes(); track type) {
            <div class="template-overview-row">
              <span class="template-type-label">{{ notificationTypeLabels[type] || type }}</span>
              <div class="template-lang-badges">
                @for (lang of availableLanguages; track lang.code) {
                  <span
                    class="lang-badge"
                    [class.lang-badge-active]="getTemplateLanguages(type).includes(lang.code)"
                    [title]="lang.name">
                    {{ lang.flag }}
                  </span>
                }
              </div>
            </div>
          }
        </div>
      </div>
    </div>
  }
</div>
